{
  "hash": "e8f1f955290941138870c9fa1e2a9217",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Take-Home Exercise 1\"\nauthor: \"Immanuel Leong\"\ndate: \"September 7, 2024\"\ndate-modified: \"last-modified\"\nexecute: \n  eval: true\n  echo: true\n  warning: false\n  freeze: true\n---\n\n\n## **Take-home Exercise 1: Geospatial Analytics for Social Good: Application of Spatial and Spatio-temporal Point Patterns Analysis to discover the geographical distribution of Armed Conflict in Myanmar**\n\n## 1.0 Overview\n\nGeospatial analytics hold tremendous potential to address complex problems facing society. In this study, we are tasked to apply spatial point patterns analysis methods to discover the spatial and spatio-temporal distribution of armed conflict in Myanmar.\n\n### 1.1 Objectives\n\nThe specific tasks of this take-home exercise are as follows:\n\n-   Using appropriate function of **sf** and **tidyverse** packages, import and transform the downloaded armed conflict data and administrative boundary data into sf tibble data.frames.\n\n-   Using the geospatial data sets prepared, derive quarterly KDE layers.\n\n-   Using the geospatial data sets prepared, perform 2nd-Order Spatial Point Patterns Analysis.\n\n-   Using the geospatial data sets prepared, derive quarterly spatio-temporal KDE layers.\n\n-   Using the geospatial data sets prepared, perform 2nd-Order Spatio-temporal Point Patterns Analysis.\n\n-   Using appropriate **tmap** functions, display the KDE and Spatio-temporal KDE layers on openstreetmap of Myanmar.\n\n-   Describe the spatial patterns revealed by the KDE and Spatio-temporal KDE maps.\n\n## 2.0 The Data\n\nThe following two data sets will be used:\n\n-   `2021-01-01-2024-06-30-Southeast_Asia-Myanmar.csv` This csv file provides data on armed conflict events in Myanmar from 1 January 2021 until 30 June 2024, focusing on six event types: Battles, Explosion/Remote violence, Protests, Riots, Strategic developments, and Violence against civilians. It was downloaded from [Armed Conflict Location & Event Data (ACLED)](https://acleddata.com/) on 7 September 2024.\n\n-   `mmr_polbnda_adm1_250k_mimu_1` This polygon feature data set provides information on Myanmar state and region boundaries (Admin1). It was downloaded in ESRI shapefile format from [Myanmar Information Management Unit, MIMU](#0).\n\n## 3.0 Setup\n\nFor this exercise, the following R packages are used:\n\n-   [**tidyverse**](https://www.tidyverse.org/), a collection of R packages designed for data science, and which provides functions to import, transform, and visualise the data.\n\n-   [**sf**](https://r-spatial.github.io/sf/), to import, manage and process vector-based geospatial data in R.\n\n-   [**spatstat**](https://spatstat.org/), which will be used to perform 1st- and 2nd-order spatial point patterns analysis and derive kernel density estimation (KDE) layers.\n\n-   [**tmap**](https://cran.r-project.org/web/packages/tmap/index.html)**,** which provides functions for plotting cartographic quality static point patterns maps or interactive maps.\n\n-   [**sparr**](https://tilmandavies.github.io/sparr/index.html)**,** which provides functions to estimate fixed and adaptive kernel-smoothed spatial relative risk surfaces via the density-ratio method and perform subsequent inference. Fixed-bandwidth spatiotemporal density and relative risk estimation is also supported.\n\n-   [**knitr**](https://cran.r-project.org/web/packages/knitr/index.html), a transparent engine for dynamic report generation with R.\n\n-   [**gifski**](https://cran.r-project.org/web/packages/gifski/index.html), which creates animated GIF images.\n\n-   [**raster**](https://cran.r-project.org/web/packages/raster/) which reads, writes, manipulates, analyses and model of gridded spatial data (i.e. raster). In this exercise, it will be used to convert image output generated by spatstat into raster format.\n\nInstall and launch these packages.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(tidyverse, sf, spatstat, tmap, sparr, gifski, knitr, raster)\n```\n:::\n\n\n## 4.0 Importing the Data\n\n### 4.1 Importing Spatial Data\n\nImport `mmr_polbnda_adm2_250k_mimu`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nadminboundaries_sf <- st_read(dsn = \"data\", layer = \"mmr_polbnda_adm1_250k_mimu_1\", as_tibble = TRUE)\n```\n:::\n\n\n`adminboundaries_sf` has a total of 15 features, and is projected in WGS 84.\n\nWe save `adminboundaries_sf` with the *write_rds()* function.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(adminboundaries_sf, \"data/rds/adminboundaries_sf.rds\")\n```\n:::\n\n::: {.cell}\n\n:::\n\n\nCheck the class of `adminboundaries_sf`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nclass(adminboundaries_sf)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"sf\"         \"tbl_df\"     \"tbl\"        \"data.frame\"\n```\n\n\n:::\n:::\n\n\nAs required, it is a sf tibble data.frame.\n\nVerify that all the geometries in `adminboundaries_sf` are valid.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlength(which(st_is_valid(adminboundaries_sf) == TRUE))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 15\n```\n\n\n:::\n:::\n\n\nSometimes, when importing geospatial data into R, the coordinate system of the source data is wrongly assigned during the importing process. Check the CRS of `adminboundaries_sf`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nst_crs(adminboundaries_sf)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCoordinate Reference System:\n  User input: WGS 84 \n  wkt:\nGEOGCRS[\"WGS 84\",\n    DATUM[\"World Geodetic System 1984\",\n        ELLIPSOID[\"WGS 84\",6378137,298.257223563,\n            LENGTHUNIT[\"metre\",1]]],\n    PRIMEM[\"Greenwich\",0,\n        ANGLEUNIT[\"degree\",0.0174532925199433]],\n    CS[ellipsoidal,2],\n        AXIS[\"latitude\",north,\n            ORDER[1],\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n        AXIS[\"longitude\",east,\n            ORDER[2],\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n    ID[\"EPSG\",4326]]\n```\n\n\n:::\n:::\n\n\nThe EPSG code indicated is 4326, which is correct since the data is projected in WGS 84.\n\n### 4.2 Importing Aspatial Data\n\nSince `2021-01-01-2024-06-30-Southeast_Asia-Myanmar.csv` is in csv format, we used *read_csv()* of the **readr** package to import it.\n\n\n::: {.cell}\n\n```{.r .cell-code}\narmedconflict <- read_csv(\"data/2021-01-01-2024-06-30-Southeast_Asia-Myanmar.csv\")\n\nglimpse(armedconflict)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 51,553\nColumns: 31\n$ event_id_cnty      <chr> \"MMR64313\", \"MMR64320\", \"MMR64321\", \"MMR64322\", \"MM…\n$ event_date         <chr> \"30 June 2024\", \"30 June 2024\", \"30 June 2024\", \"30…\n$ year               <dbl> 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024, 202…\n$ time_precision     <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …\n$ disorder_type      <chr> \"Political violence\", \"Political violence\", \"Politi…\n$ event_type         <chr> \"Battles\", \"Battles\", \"Battles\", \"Strategic develop…\n$ sub_event_type     <chr> \"Armed clash\", \"Armed clash\", \"Armed clash\", \"Chang…\n$ actor1             <chr> \"People's Defense Force - Mandalay\", \"People's Defe…\n$ assoc_actor_1      <chr> \"MDA - AGF: Madaya - The Authentic Genes Force; SST…\n$ inter1             <dbl> 3, 3, 3, 1, 3, 1, 1, 2, 1, 1, 1, 1, 3, 3, 3, 7, 1, …\n$ actor2             <chr> \"Military Forces of Myanmar (2021-)\", \"Military For…\n$ assoc_actor_2      <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, \"Uniden…\n$ inter2             <dbl> 1, 1, 1, 0, 1, 0, 2, 1, 2, 2, 2, 3, 1, 1, 7, 0, 0, …\n$ interaction        <dbl> 13, 13, 13, 10, 13, 10, 12, 12, 12, 12, 12, 13, 13,…\n$ civilian_targeting <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…\n$ iso                <dbl> 104, 104, 104, 104, 104, 104, 104, 104, 104, 104, 1…\n$ region             <chr> \"Southeast Asia\", \"Southeast Asia\", \"Southeast Asia…\n$ country            <chr> \"Myanmar\", \"Myanmar\", \"Myanmar\", \"Myanmar\", \"Myanma…\n$ admin1             <chr> \"Mandalay\", \"Mandalay\", \"Mandalay\", \"Sagaing\", \"Sag…\n$ admin2             <chr> \"Mandalay\", \"Pyinoolwin\", \"Pyinoolwin\", \"Shwebo\", \"…\n$ admin3             <chr> \"Patheingyi\", \"Singu\", \"Thabeikkyin\", \"Khin-U\", \"My…\n$ location           <chr> \"Aung Tha Pyay\", \"Pin Lel Gyi\", \"Thabeikkyin\", \"Khi…\n$ latitude           <dbl> 22.1504, 22.5752, 22.8800, 22.7744, 21.9251, 22.083…\n$ longitude          <dbl> 96.2364, 96.0661, 95.9700, 95.6980, 95.5758, 94.902…\n$ geo_precision      <dbl> 2, 1, 2, 2, 2, 2, 1, 1, 2, 1, 1, 2, 1, 1, 2, 2, 1, …\n$ source             <chr> \"Democratic Voice of Burma; Irrawaddy\", \"Irrawaddy\"…\n$ source_scale       <chr> \"National\", \"National\", \"National\", \"Subnational-Na…\n$ notes              <chr> \"On 30 June 2024, near Aung Tha Pyay village (Pathe…\n$ fatalities         <dbl> 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, …\n$ tags               <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…\n$ timestamp          <dbl> 1720552468, 1720552468, 1720552468, 1720552468, 172…\n```\n\n\n:::\n:::\n\n\nThe longitude and latitude fields capture the x- and y-coordinates of the data points respectively. They appear to be in the wgs84 Geographic Coordinate System.\n\nWe then convert `armedconflict` to an sf object.\n\n\n::: {.cell}\n\n```{.r .cell-code}\narmedconflict_sf <- st_as_sf(armedconflict, coords = c(\"longitude\",\"latitude\"), crs = 4326)\n\nst_geometry(armedconflict_sf)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nGeometry set for 51553 features \nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: 92.1837 ymin: 9.9824 xmax: 100.3576 ymax: 27.5053\nGeodetic CRS:  WGS 84\nFirst 5 geometries:\n```\n\n\n:::\n:::\n\n\n`armedconflict_sf` has a total of 51553 features.\n\nCheck the class of `armedconflict_sf` .\n\n\n::: {.cell}\n\n```{.r .cell-code}\nclass(armedconflict_sf)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"sf\"         \"tbl_df\"     \"tbl\"        \"data.frame\"\n```\n\n\n:::\n:::\n\n\nAs required, it is a sf tibble data.frame.\n\nVerify that all the geometries in `armedconflict_sf` are valid.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlength(which(st_is_valid(armedconflict_sf) == TRUE))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 51553\n```\n\n\n:::\n:::\n\n\n### 4.3 Transforming the Projection of the Data\n\n`adminboundaries_sf` and `armedconflict_sf` are projected in the WGS 84 geographic coordinate system, which is not appropriate since the analysis will require distance and area measurements. Reproject both data to the Indian 1954 / UTM zone 46N projected coordinate system, which can be used in Myanmar.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nadminboundaries_sf_23946 <- st_transform(adminboundaries_sf, crs = 23946)\n\narmedconflict_sf_23946 <- st_transform(armedconflict_sf, crs = 23946)\n```\n:::\n\n\nCheck the content of each data frame.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nst_geometry(adminboundaries_sf_23946)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nGeometry set for 15 features \nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 414071.5 ymin: 1076012 xmax: 1347630 ymax: 3165918\nProjected CRS: Indian 1954 / UTM zone 46N\nFirst 5 geometries:\n```\n\n\n:::\n\n```{.r .cell-code}\nst_geometry(armedconflict_sf_23946)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nGeometry set for 51553 features \nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: 415274.3 ymin: 1108506 xmax: 1265209 ymax: 3051406\nProjected CRS: Indian 1954 / UTM zone 46N\nFirst 5 geometries:\n```\n\n\n:::\n:::\n\n\nAs desired, they have both been reprojected to the Indian 1954 / UTM zone 46N projected coordinate system.\n\n## 5.0 Data Wrangling\n\n### 5.1 Organising point events data by quarter\n\nTo derive quarterly KDE layers, we must first organise the armed conflict events in `armedconflict_sf_23946` by quarter. We use functions from the **dplyr** and **lubridate** packages of the **tidyverse**.\n\n\n::: {.cell}\n\n```{.r .cell-code}\narmedconflictquarterly_sf <- armedconflict_sf_23946 %>%\n  mutate(\"quarter\" = quarter(dmy(event_date)))\n\n\nglimpse(armedconflictquarterly_sf)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 51,553\nColumns: 31\n$ event_id_cnty      <chr> \"MMR64313\", \"MMR64320\", \"MMR64321\", \"MMR64322\", \"MM…\n$ event_date         <chr> \"30 June 2024\", \"30 June 2024\", \"30 June 2024\", \"30…\n$ year               <dbl> 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024, 202…\n$ time_precision     <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …\n$ disorder_type      <chr> \"Political violence\", \"Political violence\", \"Politi…\n$ event_type         <chr> \"Battles\", \"Battles\", \"Battles\", \"Strategic develop…\n$ sub_event_type     <chr> \"Armed clash\", \"Armed clash\", \"Armed clash\", \"Chang…\n$ actor1             <chr> \"People's Defense Force - Mandalay\", \"People's Defe…\n$ assoc_actor_1      <chr> \"MDA - AGF: Madaya - The Authentic Genes Force; SST…\n$ inter1             <dbl> 3, 3, 3, 1, 3, 1, 1, 2, 1, 1, 1, 1, 3, 3, 3, 7, 1, …\n$ actor2             <chr> \"Military Forces of Myanmar (2021-)\", \"Military For…\n$ assoc_actor_2      <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, \"Uniden…\n$ inter2             <dbl> 1, 1, 1, 0, 1, 0, 2, 1, 2, 2, 2, 3, 1, 1, 7, 0, 0, …\n$ interaction        <dbl> 13, 13, 13, 10, 13, 10, 12, 12, 12, 12, 12, 13, 13,…\n$ civilian_targeting <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…\n$ iso                <dbl> 104, 104, 104, 104, 104, 104, 104, 104, 104, 104, 1…\n$ region             <chr> \"Southeast Asia\", \"Southeast Asia\", \"Southeast Asia…\n$ country            <chr> \"Myanmar\", \"Myanmar\", \"Myanmar\", \"Myanmar\", \"Myanma…\n$ admin1             <chr> \"Mandalay\", \"Mandalay\", \"Mandalay\", \"Sagaing\", \"Sag…\n$ admin2             <chr> \"Mandalay\", \"Pyinoolwin\", \"Pyinoolwin\", \"Shwebo\", \"…\n$ admin3             <chr> \"Patheingyi\", \"Singu\", \"Thabeikkyin\", \"Khin-U\", \"My…\n$ location           <chr> \"Aung Tha Pyay\", \"Pin Lel Gyi\", \"Thabeikkyin\", \"Khi…\n$ geo_precision      <dbl> 2, 1, 2, 2, 2, 2, 1, 1, 2, 1, 1, 2, 1, 1, 2, 2, 1, …\n$ source             <chr> \"Democratic Voice of Burma; Irrawaddy\", \"Irrawaddy\"…\n$ source_scale       <chr> \"National\", \"National\", \"National\", \"Subnational-Na…\n$ notes              <chr> \"On 30 June 2024, near Aung Tha Pyay village (Pathe…\n$ fatalities         <dbl> 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, …\n$ tags               <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…\n$ timestamp          <dbl> 1720552468, 1720552468, 1720552468, 1720552468, 172…\n$ geometry           <POINT [m]> POINT (833792.1 2452830), POINT (815256.3 249…\n$ quarter            <int> 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, …\n```\n\n\n:::\n:::\n\n\n`armedconflictquarterly_sf` is then broken down into individual data frames for each quarter from 1 January 2021 until 30 June 2024, that is, from Q1 2021 until Q2 2024. Convert each of these data sets to **spatstat**'s ppp object format.\n\n\n::: {.cell}\n\n```{.r .cell-code}\narmedconflictQ121_ppp <- armedconflictquarterly_sf %>%\n  filter(quarter == 1 & year == 2021) %>%\n  as.ppp(.)\n\narmedconflictQ221_ppp <- armedconflictquarterly_sf %>%\n  filter(quarter == 2 & year == 2021) %>%\n  as.ppp(.)\n\narmedconflictQ321_ppp <- armedconflictquarterly_sf %>%\n  filter(quarter == 3 & year == 2021) %>%\n  as.ppp(.)\n\narmedconflictQ421_ppp <- armedconflictquarterly_sf %>%\n  filter(quarter == 4 & year == 2021) %>%\n  as.ppp(.)\n\narmedconflictQ122_ppp <- armedconflictquarterly_sf %>%\n  filter(quarter == 1 & year == 2022) %>%\n  as.ppp(.)\n\narmedconflictQ222_ppp <- armedconflictquarterly_sf %>%\n  filter(quarter == 2 & year == 2022) %>%\n  as.ppp(.)\n\narmedconflictQ322_ppp <- armedconflictquarterly_sf %>%\n  filter(quarter == 3 & year == 2022) %>%\n  as.ppp(.)\n\narmedconflictQ422_ppp <- armedconflictquarterly_sf %>%\n  filter(quarter == 4 & year == 2022) %>%\n  as.ppp(.)\n\narmedconflictQ123_ppp <- armedconflictquarterly_sf %>%\n  filter(quarter == 1 & year == 2023) %>%\n  as.ppp(.)\n\narmedconflictQ223_ppp <- armedconflictquarterly_sf %>%\n  filter(quarter == 2 & year == 2023) %>%\n  as.ppp(.)\n\narmedconflictQ323_ppp <- armedconflictquarterly_sf %>%\n  filter(quarter == 3 & year == 2023) %>%\n  as.ppp(.)\n\narmedconflictQ423_ppp <- armedconflictquarterly_sf %>%\n  filter(quarter == 4 & year == 2023) %>%\n  as.ppp(.)\n\narmedconflictQ124_ppp <- armedconflictquarterly_sf %>%\n  filter(quarter == 1 & year == 2024) %>%\n  as.ppp(.)\n\narmedconflictQ224_ppp <- armedconflictquarterly_sf %>%\n  filter(quarter == 2 & year == 2024) %>%\n  as.ppp(.)\n```\n:::\n\n\nNext, we verify the number of locations with more than one point event in each quarter.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nquarterly <- list(armedconflictQ121_ppp, armedconflictQ221_ppp, armedconflictQ321_ppp, armedconflictQ421_ppp, armedconflictQ122_ppp, armedconflictQ222_ppp, armedconflictQ322_ppp, armedconflictQ422_ppp, armedconflictQ123_ppp, armedconflictQ223_ppp, armedconflictQ323_ppp, armedconflictQ423_ppp, armedconflictQ124_ppp, armedconflictQ224_ppp)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfor (i in quarterly) {\n  result = sum(multiplicity(i) > 1)\n  print(result)\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0\n[1] 0\n[1] 0\n[1] 0\n[1] 0\n[1] 0\n[1] 0\n[1] 0\n[1] 0\n[1] 0\n[1] 0\n[1] 0\n[1] 0\n[1] 0\n```\n\n\n:::\n:::\n\n\nThe output shows that there are no duplicated point events in any of the quarterly data frames.\n\n### 5.2 Creating owin object\n\nThe code chunk below is used to covert `adminboundaries_sf_23946` into an owin object of **spatstat**, allowing the later analysis to be confined to Myanmar's borders. We confirm that the output is indeed an owin object with the *class()* function, and then plot the boundaries.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nadminboundaries_owin <- as.owin(adminboundaries_sf_23946)\n\nclass(adminboundaries_owin)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"owin\"\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(adminboundaries_owin)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\n### 5.3 Combining point events objects and owin object\n\nWe then combine both the point events objects and owin object into a single ppp object for each quarter.\n\n\n::: {.cell}\n\n```{.r .cell-code}\narmedconflictQ121mm_ppp <- armedconflictQ121_ppp[adminboundaries_owin]\n\narmedconflictQ221mm_ppp <- armedconflictQ221_ppp[adminboundaries_owin]\n\narmedconflictQ321mm_ppp <- armedconflictQ321_ppp[adminboundaries_owin]\n\narmedconflictQ421mm_ppp <- armedconflictQ421_ppp[adminboundaries_owin]\n\narmedconflictQ122mm_ppp <- armedconflictQ122_ppp[adminboundaries_owin]\n\narmedconflictQ222mm_ppp <- armedconflictQ222_ppp[adminboundaries_owin]\n\narmedconflictQ322mm_ppp <- armedconflictQ322_ppp[adminboundaries_owin]\n\narmedconflictQ422mm_ppp <- armedconflictQ422_ppp[adminboundaries_owin]\n\narmedconflictQ123mm_ppp <- armedconflictQ123_ppp[adminboundaries_owin]\n\narmedconflictQ223mm_ppp <- armedconflictQ223_ppp[adminboundaries_owin]\n\narmedconflictQ323mm_ppp <- armedconflictQ323_ppp[adminboundaries_owin]\n\narmedconflictQ423mm_ppp <- armedconflictQ423_ppp[adminboundaries_owin]\n\narmedconflictQ124mm_ppp <- armedconflictQ124_ppp[adminboundaries_owin]\n\narmedconflictQ224mm_ppp <- armedconflictQ224_ppp[adminboundaries_owin]\n```\n:::\n\n\nWe save each of these ppp objects with the *write_rds()* function.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(armedconflictQ121mm_ppp, \"data/rds/armedconflictQ121mm_ppp.rds\")\n\nwrite_rds(armedconflictQ221mm_ppp, \"data/rds/armedconflictQ221mm_ppp.rds\")\n\nwrite_rds(armedconflictQ321mm_ppp, \"data/rds/armedconflictQ321mm_ppp.rds\")\n\nwrite_rds(armedconflictQ421mm_ppp, \"data/rds/armedconflictQ421mm_ppp.rds\")\n\nwrite_rds(armedconflictQ122mm_ppp, \"data/rds/armedconflictQ122mm_ppp.rds\")\n\nwrite_rds(armedconflictQ222mm_ppp, \"data/rds/armedconflictQ222mm_ppp.rds\")\n\n\nwrite_rds(armedconflictQ322mm_ppp, \"data/rds/armedconflictQ322mm_ppp.rds\")\n\nwrite_rds(armedconflictQ422mm_ppp, \"data/rds/armedconflictQ422mm_ppp.rds\")\n\nwrite_rds(armedconflictQ123mm_ppp, \"data/rds/armedconflictQ123mm_ppp.rds\")\n\nwrite_rds(armedconflictQ223mm_ppp, \"data/rds/armedconflictQ223mm_ppp.rds\")\n\n\nwrite_rds(armedconflictQ323mm_ppp, \"data/rds/armedconflictQ323mm_ppp.rds\")\n\nwrite_rds(armedconflictQ423mm_ppp, \"data/rds/armedconflictQ423mm_ppp.rds\")\n\nwrite_rds(armedconflictQ124mm_ppp, \"data/rds/armedconflictQ124mm_ppp.rds\")\n\nwrite_rds(armedconflictQ224mm_ppp, \"data/rds/armedconflictQ224mm_ppp.rds\")\n```\n:::\n\n::: {.cell}\n\n:::\n\n\n## 5.1 Kernel Density Estimation\n\nWe now try deriving the KDE layers for Q1 2021.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nkde_armedconflictQ121mm <- density(armedconflictQ121mm_ppp, sigma = bw.diggle, edge = TRUE, kernel = \"quartic\")\n\nplot(kde_armedconflictQ121mm)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n\n\nThe density values of the output are extremely small. This is because the default measurement of the Indian 1954 / UTM zone 46N system is in metres. We convert the unit of measurement to kilometers.\n\n\n::: {.cell}\n\n```{.r .cell-code}\narmedconflictQ121mm_ppp_km <- rescale.ppp(armedconflictQ121mm_ppp, 1000, \"km\")\n\nkde_armedconflictQ121mm_km <- density(armedconflictQ121mm_ppp_km, sigma = bw.diggle, edge = TRUE, kernel = \"quartic\")\n\nplot(kde_armedconflictQ121mm_km)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-23-1.png){width=672}\n:::\n:::\n\n\nThere is another problem. Apart from a few specks, most of Myanmar is dark. We check the bandwidth derived by the diggle method.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbw.diggle(armedconflictQ121mm_ppp_km)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    sigma \n0.2283657 \n```\n\n\n:::\n:::\n\n\nWe may need a larger bandwidth to prevent undersmoothing, particularly given Myanmar's relatively large land area and the rural nature of most of the country. We try the CvL automatic bandwidth selection method instead.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nkde_armedconflictQ121mm_kmCvL <- density(armedconflictQ121mm_ppp_km, sigma = bw.CvL, edge = TRUE, kernel = \"quartic\")\n\nplot(kde_armedconflictQ121mm_kmCvL)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-25-1.png){width=672}\n:::\n:::\n\n\nWe can now clearly identify an area of extremely high intensity in central Myanmar, centered around Yangon Region, Myanmar's most populous region and home to its largest city. Another area with relatively high intensity stretches from southern Kachin State, through northwestern Shan State, Mandalay Region and Sagaing Region.\n\nWe repeat the process of rescaling the data and deriving KDE layers for every quarter from 1 January 2021 until 30 June 2024.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nkde_armedconflictQ221mm_kmCvL <- armedconflictQ221mm_ppp %>%\n  rescale.ppp(., 1000, \"km\") %>%\n  density(., sigma = bw.CvL, edge = TRUE, kernel = \"quartic\")\n \nkde_armedconflictQ321mm_kmCvL <- armedconflictQ321mm_ppp %>%\n  rescale.ppp(., 1000, \"km\") %>%\n  density(., sigma = bw.CvL, edge = TRUE, kernel = \"quartic\")\n\nkde_armedconflictQ421mm_kmCvL <- armedconflictQ421mm_ppp %>%\n  rescale.ppp(., 1000, \"km\") %>%\n  density(., sigma = bw.CvL, edge = TRUE, kernel = \"quartic\")\n\nkde_armedconflictQ122mm_kmCvL <- armedconflictQ122mm_ppp %>%\n  rescale.ppp(., 1000, \"km\") %>%\n  density(., sigma = bw.CvL, edge = TRUE, kernel = \"quartic\")\n\nkde_armedconflictQ222mm_kmCvL <- armedconflictQ222mm_ppp %>%\n  rescale.ppp(., 1000, \"km\") %>%\n  density(., sigma = bw.CvL, edge = TRUE, kernel = \"quartic\")\n\nkde_armedconflictQ322mm_kmCvL <- armedconflictQ322mm_ppp %>%\n  rescale.ppp(., 1000, \"km\") %>%\n  density(., sigma = bw.CvL, edge = TRUE, kernel = \"quartic\")\n\nkde_armedconflictQ422mm_kmCvL <- armedconflictQ422mm_ppp %>%\n  rescale.ppp(., 1000, \"km\") %>%\n  density(., sigma = bw.CvL, edge = TRUE, kernel = \"quartic\")\n\nkde_armedconflictQ123mm_kmCvL <- armedconflictQ123mm_ppp %>%\n  rescale.ppp(., 1000, \"km\") %>%\n  density(., sigma = bw.CvL, edge = TRUE, kernel = \"quartic\")\n\nkde_armedconflictQ223mm_kmCvL <- armedconflictQ223mm_ppp %>%\n  rescale.ppp(., 1000, \"km\") %>%\n  density(., sigma = bw.CvL, edge = TRUE, kernel = \"quartic\")\n\nkde_armedconflictQ323mm_kmCvL <- armedconflictQ323mm_ppp %>%\n  rescale.ppp(., 1000, \"km\") %>%\n  density(., sigma = bw.CvL, edge = TRUE, kernel = \"quartic\")\n\nkde_armedconflictQ423mm_kmCvL <- armedconflictQ423mm_ppp %>%\n  rescale.ppp(., 1000, \"km\") %>%\n  density(., sigma = bw.CvL, edge = TRUE, kernel = \"quartic\")\n\nkde_armedconflictQ124mm_kmCvL <- armedconflictQ124mm_ppp %>%\n  rescale.ppp(., 1000, \"km\") %>%\n  density(., sigma = bw.CvL, edge = TRUE, kernel = \"quartic\")\n\nkde_armedconflictQ224mm_kmCvL <- armedconflictQ224mm_ppp %>%\n  rescale.ppp(., 1000, \"km\") %>%\n  density(., sigma = bw.CvL, edge = TRUE, kernel = \"quartic\")\n```\n:::\n\n\nAgain, we save the quarterly KDE layers with *write_rds()*.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(kde_armedconflictQ121mm_kmCvL, file = \"data/rds/kde_armedconflictQ121mm_kmCvL\")\n\nwrite_rds(kde_armedconflictQ221mm_kmCvL, file = \"data/rds/kde_armedconflictQ221mm_kmCvL\")\n\nwrite_rds(kde_armedconflictQ321mm_kmCvL, file = \"data/rds/kde_armedconflictQ321mm_kmCvL\")\n\nwrite_rds(kde_armedconflictQ421mm_kmCvL, file = \"data/rds/kde_armedconflictQ421mm_kmCvL\")\n\nwrite_rds(kde_armedconflictQ122mm_kmCvL, file = \"data/rds/kde_armedconflictQ122mm_kmCvL\")\n\nwrite_rds(kde_armedconflictQ222mm_kmCvL, file = \"data/rds/kde_armedconflictQ222mm_kmCvL\")\n\nwrite_rds(kde_armedconflictQ322mm_kmCvL, file = \"data/rds/kde_armedconflictQ322mm_kmCvL\")\n\nwrite_rds(kde_armedconflictQ422mm_kmCvL, file = \"data/rds/kde_armedconflictQ422mm_kmCvL\")\n\nwrite_rds(kde_armedconflictQ123mm_kmCvL, file = \"data/rds/kde_armedconflictQ123mm_kmCvL\")\n\nwrite_rds(kde_armedconflictQ223mm_kmCvL, file = \"data/rds/kde_armedconflictQ223mm_kmCvL\")\n\nwrite_rds(kde_armedconflictQ323mm_kmCvL, file = \"data/rds/kde_armedconflictQ323mm_kmCvL\")\n\nwrite_rds(kde_armedconflictQ423mm_kmCvL, file = \"data/rds/kde_armedconflictQ423mm_kmCvL\")\n\nwrite_rds(kde_armedconflictQ124mm_kmCvL, file = \"data/rds/kde_armedconflictQ124mm_kmCvL\")\n\nwrite_rds(kde_armedconflictQ224mm_kmCvL, file = \"data/rds/kde_armedconflictQ224mm_kmCvL\")\n```\n:::\n\n::: {.cell}\n\n:::\n\n\nWe can now plot these quarterly KDE layers.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(kde_armedconflictQ121mm_kmCvL)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-29-1.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(kde_armedconflictQ221mm_kmCvL)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-29-2.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(kde_armedconflictQ321mm_kmCvL)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-29-3.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(kde_armedconflictQ421mm_kmCvL)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-29-4.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(kde_armedconflictQ122mm_kmCvL)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-29-5.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(kde_armedconflictQ222mm_kmCvL)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-29-6.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(kde_armedconflictQ322mm_kmCvL)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-29-7.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(kde_armedconflictQ422mm_kmCvL)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-29-8.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(kde_armedconflictQ123mm_kmCvL)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-29-9.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(kde_armedconflictQ223mm_kmCvL)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-29-10.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(kde_armedconflictQ323mm_kmCvL)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-29-11.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(kde_armedconflictQ423mm_kmCvL)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-29-12.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(kde_armedconflictQ124mm_kmCvL)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-29-13.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(kde_armedconflictQ224mm_kmCvL)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-29-14.png){width=672}\n:::\n:::\n\n\n## 6.0 **2nd Order Spatial Point Patterns Analysis**\n\nNext, we perform 2nd order spatial point patterns analysis, testing whether the event points in each cluster are clustered, randomly distributed, or dispersed. To do this, we would ideally use the L function, which estimates spatial dependence over a wider range of scales than the G and F functions. However, with a total of 51553 event points across all 14 quarters, this would likely be too computationally demanding and take an extremely long amount of time. Hence, we can use the F function instead.\n\nIn the following code chunks, we generate Monte Carlo simulations of the F function under complete spatial randomness for each quarter, and plot the output against the F function derived from the observed data. Through this, we can perform a test of the null hypothesis that the distribution of armed conflict events is random in each quarter, with alpha = 2.5%.\n\nWe use the *set.seed()* function to ensure that the simulation results are reproducible.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(5)\n\narmedconflictQ121mm_csr <- envelope(armedconflictQ121mm_ppp, Fest, nsim = 39, global = TRUE)\n\narmedconflictQ221mm_csr <- envelope(armedconflictQ221mm_ppp, Fest, nsim = 39, global = TRUE)\n\narmedconflictQ321mm_csr <- envelope(armedconflictQ321mm_ppp, Fest, nsim = 39, global = TRUE)\n\narmedconflictQ421mm_csr <- envelope(armedconflictQ421mm_ppp, Fest, nsim = 39, global = TRUE)\n\narmedconflictQ122mm_csr <- envelope(armedconflictQ122mm_ppp, Fest, nsim = 39, global = TRUE)\n\narmedconflictQ222mm_csr <- envelope(armedconflictQ222mm_ppp, Fest, nsim = 39, global = TRUE)\n\narmedconflictQ322mm_csr <- envelope(armedconflictQ322mm_ppp, Fest, nsim = 39, global = TRUE)\n\narmedconflictQ422mm_csr <- envelope(armedconflictQ422mm_ppp, Fest, nsim = 39, global = TRUE)\n\narmedconflictQ123mm_csr <- envelope(armedconflictQ123mm_ppp, Fest, nsim = 39, global = TRUE)\n\narmedconflictQ223mm_csr <- envelope(armedconflictQ223mm_ppp, Fest, nsim = 39, global = TRUE)\n\narmedconflictQ323mm_csr <- envelope(armedconflictQ323mm_ppp, Fest, nsim = 39, global = TRUE)\n\narmedconflictQ423mm_csr <- envelope(armedconflictQ423mm_ppp, Fest, nsim = 39, global = TRUE)\n\narmedconflictQ124mm_csr <- envelope(armedconflictQ124mm_ppp, Fest, nsim = 39, global = TRUE)\n\narmedconflictQ224mm_csr <- envelope(armedconflictQ224mm_ppp, Fest, nsim = 39, global = TRUE)\n```\n:::\n\n\nWe save each of the simulation outputs with *write_rds()*.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(armedconflictQ121mm_csr, file = \"data/rds/armedconflictQ121mm_csr\")\n\nwrite_rds(armedconflictQ221mm_csr, file = \"data/rds/armedconflictQ221mm_csr\")\n\nwrite_rds(armedconflictQ321mm_csr, file = \"data/rds/armedconflictQ321mm_csr\")\n\nwrite_rds(armedconflictQ421mm_csr, file = \"data/rds/armedconflictQ421mm_csr\")\n\nwrite_rds(armedconflictQ122mm_csr, file = \"data/rds/armedconflictQ122mm_csr\")\n\nwrite_rds(armedconflictQ222mm_csr, file = \"data/rds/armedconflictQ222mm_csr\")\n\nwrite_rds(armedconflictQ322mm_csr, file = \"data/rds/armedconflictQ322mm_csr\")\n\nwrite_rds(armedconflictQ422mm_csr, file = \"data/rds/armedconflictQ422mm_csr\")\n\nwrite_rds(armedconflictQ123mm_csr, file = \"data/rds/armedconflictQ123mm_csr\")\n\nwrite_rds(armedconflictQ223mm_csr, file = \"data/rds/armedconflictQ223mm_csr\")\n\nwrite_rds(armedconflictQ323mm_csr, file = \"data/rds/armedconflictQ323mm_csr\")\n\nwrite_rds(armedconflictQ423mm_csr, file = \"data/rds/armedconflictQ423mm_csr\")\n\nwrite_rds(armedconflictQ124mm_csr, file = \"data/rds/armedconflictQ124mm_csr\")\n\nwrite_rds(armedconflictQ224mm_csr, file = \"data/rds/armedconflictQ224mm_csr\")\n```\n:::\n\n::: {.cell}\n\n:::\n\n\nWe can now plot the simulation outputs.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(armedconflictQ121mm_csr)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-33-1.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(armedconflictQ221mm_csr)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-33-2.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(armedconflictQ321mm_csr)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-33-3.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(armedconflictQ421mm_csr)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-33-4.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(armedconflictQ122mm_csr)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-33-5.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(armedconflictQ222mm_csr)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-33-6.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(armedconflictQ322mm_csr)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-33-7.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(armedconflictQ422mm_csr)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-33-8.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(armedconflictQ123mm_csr)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-33-9.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(armedconflictQ223mm_csr)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-33-10.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(armedconflictQ323mm_csr)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-33-11.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(armedconflictQ423mm_csr)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-33-12.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(armedconflictQ124mm_csr)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-33-13.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(armedconflictQ224mm_csr)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-33-14.png){width=672}\n:::\n:::\n\n\nIn all of the plots, the F function derived from the observed data lies well outside the simulated envelopes. Thus, at alpha = 2.5%, there is sufficient evidence to reject the null hypothesis that the distribution of armed conflict events in Myanmar is random in each quarter. We can conclude that in every quarter studied, the distribution of armed conflict events in Myanmar is non-random.\n\nMoreover, since the F function lies below the lower envelope, the armed conflict events are distributed in a clustered pattern in every quarter. This makes sense as intuitively, armed conflict events are likely to be concentrated in areas with weak or non-existent levels of governmental control, or in dense population centres (respecially in the case of Protests, Riots, and Violence against civilians).\n\nIndeed, the longstanding conflict in Myanmar, which has been described as \"[the world’s longest continuing civil war](https://www.brookings.edu/blog/order-from-chaos/2019/12/06/peace-and-war-in-myanmar/ \"the world’s longest continuing civil war\")\" (Rieffel, 2019), is one with strong inter-ethnic and inter-regional dimensions, pitting ethnic armed organizations seeking greater regional autonomy such as the Karen National Liberation Army and the Shan State Army against the Tatmadaw, and fighting had been concentrated in border regions up till the 2021 coup ([Maizland, 2022](https://www.cfr.org/backgrounder/myanmar-history-coup-military-rule-ethnic-conflict-rohingya)). After the 2021 coup, it is not surprising that armed conflict events have continued to be concentrated in certain areas where opposing forces (namely the Tatmadaw, the People's Defence Force of the anti-junta National Unity Government (NUG), as well as ethnic armed organisations allied to the NUG or aiming to consolidate their hold on their territories) are fighting for control ([Maizland, 2022](https://www.cfr.org/backgrounder/myanmar-history-coup-military-rule-ethnic-conflict-rohingya)). In addition, we would also expect certain types of armed conflict events such as Protests, Riots and Violence against civilians, to be clustered in densely-populated areas, such as cities and major towns, where mass demonstrations by civilians can be most conveniently organised.\n\n## 7.0 **Spatio-Temporal Point Patterns Analysis**\n\nFrom the quarterly KDE layers derived above, we notice that the relative intensity of armed conflict events around Yangon was highest in early 2021, immediately after the coup, but declined compared to the rest of Myanmar thereafter. This may reflect how mass demonstrations arose in Myanmar's largest city in the immediate aftermath of the 2021 coup and in the following months (e.g. [Myanmar: more than 100,000 protest in streets against coup, 2021](https://www.theguardian.com/world/2021/feb/17/suu-kyi-myanmar-trial-protests-military); [Robinson & Wallace, 2021](https://asia.nikkei.com/Spotlight/Myanmar-Crisis/Myanmar-protest-crackdown-moves-to-new-urban-phase); [Myanmar protesters paint Yangon red, defying bloody army crackdown, 2021](https://www.straitstimes.com/asia/se-asia/myanmar-protesters-paint-yangon-red-defying-bloody-army-crackdown)), but gradually lost steam as the Tatmadaw reasserted control.\n\nThis is an example of a spatio-temporal point process. A spatio-temporal point process (also called space-time or spatial-temporal point process) is a random collection of points, where each point represents the time and location of an event.\n\nHence, we conduct spatio-temporal point patterns analysis on the data, this time focusing specifically on Protests and Riots in Yangon Region.\n\n### 7.1 Extracting the Study Area\n\nWe extract Yangon Region from `adminboundaries_sf_23946`, and then plot it.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nyangon <- adminboundaries_sf_23946 %>%\n  filter(ST == \"Yangon\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(yangon, main = \"Yangon Region\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-35-1.png){width=672}\n:::\n:::\n\n\nWe see that Yangon Region includes offshore islands. For the purposes of our analysis, we should remove these islands and focus on mainland Yangon Region, around the city of Yangon itself, which is where most of the population lives.\n\nWe use *st_cast()* to split the MULTIPOLYGON into multiple POLYGON features, arrange these features by their land area, and then choose the largest area, which is the mainland (this method was inspired by a previous participant in this course, namely [Ho, 2024](https://is415-gaa-matthew-ho.netlify.app/takehomeex/takehomeex1/the1#singapore-boundaries), as well as an answer on [StackExchange](https://stackoverflow.com/questions/50375619/how-to-remove-all-the-small-islands-from-the-census-shapefile-zip-code-level)).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nyangon_mainland <- yangon %>% \n  st_cast(\"POLYGON\") %>%\n  mutate(area = st_area(.)) %>%\n  arrange(desc(area)) %>%\n  slice(1)\n```\n:::\n\n\nPlotting this, we confirm that we have successfully extracted the mainland portion of Yangon Region.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(yangon_mainland)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-37-1.png){width=672}\n:::\n:::\n\n\nWe can now convert this to an owin object and plot it.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nyangon_owin <- as.owin(yangon_mainland)\n\nplot(yangon_owin)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-38-1.png){width=672}\n:::\n:::\n\n\n### 7.2 Preparing Protest and Riot Data\n\n`armedconflict_sf_23946` contains data on six types of armed conflict events. However, we are now focusing on two types: Riots and Protests.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nriotprotests <- armedconflict_sf_23946 %>%\n  filter(event_type %in% c(\"Protests\", \"Riots\"))\n```\n:::\n\n\nUsing the *mutate()* function and the *quarter()* function, we organise the data by quarter. Next, we can remove all the fields except for quarter and geometry.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nriotprotests_date <- riotprotests %>% \n  mutate(event_date = as.numeric(dmy(event_date))) %>%\n  dplyr::select(event_date, geometry)\n```\n:::\n\n\n### 7.3 Creating ppp object\n\n\n::: {.cell}\n\n```{.r .cell-code}\nriotprotests_date_ppp <- as.ppp(riotprotests_date)\n\nriotprotests_date_ppp \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nMarked planar point pattern: 8945 points\nmarks are numeric, of storage type  'double'\nwindow: rectangle = [434051.8, 1218927.7] x [1108505.9, 3051406.1] units\n```\n\n\n:::\n:::\n\n\nThe code chunk below is used to check the output is in the correct object class.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(riotprotests_date_ppp)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nMarked planar point pattern:  8945 points\nAverage intensity 5.865822e-09 points per square unit\n\n*Pattern contains duplicated points*\n\nCoordinates are given to 10 decimal places\n\nmarks are numeric, of type 'double'\nSummary:\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n  18633   18696   18783   18919   19077   19904 \n\nWindow: rectangle = [434051.8, 1218927.7] x [1108505.9, 3051406.1] units\n                    (784900 x 1943000 units)\nWindow area = 1.52494e+12 square units\n```\n\n\n:::\n:::\n\n\nWe notice a warning that the pattern contains duplicated (i.e. coincident) points. The statistical methodology used for spatial point patterns processes is based largely on the assumption that process are *simple*, that is, that the points cannot be coincident.\n\nTo overcome this, we use *jittering*, which will add a small perturbation to the duplicate points so that they do not occupy the exact same space.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nriotprotests_date_ppp_jit <- rjitter(riotprotests_date_ppp,\n                                    retry = TRUE,\n                                    nsim = 1,\n                                    drop = TRUE)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nany(duplicated(riotprotests_date_ppp_jit))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] FALSE\n```\n\n\n:::\n:::\n\n\nThere are no longer any duplicated points.\n\n### 7.4 Combining point events object and owin object\n\nWe then combine `riotprotests_date_ppp_jit` and `yangon_owin`, confining our analysis to the boundaries of mainland Yangon Region, and plot the output.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nriotprotests_owin <- riotprotests_date_ppp_jit[yangon_owin]\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(riotprotests_owin)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-46-1.png){width=672}\n:::\n:::\n\n\n### **7.5 Computing Spatio-temporal KDE**\n\n`spattemp.density()` of sparr package computes the STKDE.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nst_kde <- spattemp.density(riotprotests_owin)\nsummary(st_kde)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSpatiotemporal Kernel Density Estimate\n\nBandwidths\n  h = 1484.59 (spatial)\n  lambda = 6.7613 (temporal)\n\nNo. of observations\n  1274 \n\nSpatial bound\n  Type: polygonal\n  2D enclosure: [778189.2, 907883.7] x [1806567, 1970206]\n\nTemporal bound\n  [18638, 19878]\n\nEvaluation\n  128 x 128 x 1241 trivariate lattice\n  Density range: [0, 1.272137e-10]\n```\n\n\n:::\n:::\n\n\n### **7.6 Plotting the spatio-temporal KDE object**\n\nIn the code chunk below, `plot()` of base R is used to plot st_kde, and *save_gif()* of **gifski** is used to turn it into an animation. To display the animation, *include_graphics()* of **knitr** is then used.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngifski::save_gif(\n  plot(st_kde, fix.range = TRUE),\n  gif_file = \"stkde_animation.gif\",\n  width = 800,\n  height = 600,\n  delay = 0.1,\n  loop = TRUE,\n  progress = TRUE)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nknitr::include_graphics(\"stkde_animation.gif\")\n```\n\n::: {.cell-output-display}\n![](stkde_animation.gif)\n:::\n:::\n\n\nAs we would expect, we can clearly see an initial surge in the intensity of riots and protests around the City of Yangon proper (located at the fork of the Yangon River) when the animation begins, around the time of the coup in 2021, which then gradually peters out as the Tatmadaw reasserted control, with rather low intensity thereafter. In addition, low intensity is observed in most of the rest of Yangon Region throughout the entire period, again confirming our prior knowledge than the City of Yangon itself was the locus of mass demonstrations against the coup.\n\n## 8.0 Display the KDE layers on openstreetmap\n\n### **8.1 Converting KDE output into grid object.**\n\nFor the remaining analysis, we will focus on events occurring in Q1 2021, when the coup occurred.\n\nWe first convert the KDE output into grid object so that it is suitable for mapping purposes.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngridded_kde_Q121 <- as(kde_armedconflictQ121mm_kmCvL,  \"SpatialGridDataFrame\")\n```\n:::\n\n\n### **8.2 Converting gridded output into raster**\n\nNext, we will convert the gridded kernel density objects into RasterLayer objects by using *raster()* of **raster** package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nkde_Q121_raster <- raster(gridded_kde_Q121)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nkde_Q121_raster\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nclass      : RasterLayer \ndimensions : 128, 128, 16384  (nrow, ncol, ncell)\nresolution : 7.293429, 16.32739  (x, y)\nextent     : 414.0715, 1347.63, 1076.012, 3165.918  (xmin, xmax, ymin, ymax)\ncrs        : NA \nsource     : memory\nnames      : v \nvalues     : -5.931695e-18, 0.04771807  (min, max)\n```\n\n\n:::\n:::\n\n\nNotice that the CRS property is NA. The code chunk below will be used to include the CRS information. In addition, recall that the default measurement of the Indian 1954 / UTM zone 46N system is in metres. However, we rescaled the data earlier so that the units of measurement would be in kilometers. We must now account for this. (This method was inspired by a previous participant in this course, namely [Khant, 2024](https://is415-geospatial-with-khant.netlify.app/take-home_ex/take-home_ex01)).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprojection(kde_Q121_raster) <- CRS(\"+init=EPSG:23946 +units=km\")\n```\n:::\n\n\n### **8.3 Visualising the output in tmap**\n\nWe can now display the output on OpenStreetMap of Myanmar using **tmap**.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode(\"view\")\n\ntm_basemap(\"OpenStreetMap\") +\n  tm_shape(kde_Q121_raster) +\n  tm_raster(\"v\", alpha = 0.5, palette = \"viridis\") +\n  tm_layout(legend.position = c(\"right\", \"bottom\"), frame = FALSE)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"leaflet html-widget html-fill-item\" id=\"htmlwidget-da9e41f81d21c27bec3b\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-da9e41f81d21c27bec3b\">{\"x\":{\"options\":{\"crs\":{\"crsClass\":\"L.CRS.EPSG3857\",\"code\":null,\"proj4def\":null,\"projectedBounds\":null,\"options\":{}}},\"calls\":[{\"method\":\"createMapPane\",\"args\":[\"tmap401\",401]},{\"method\":\"addProviderTiles\",\"args\":[\"OpenStreetMap\",null,\"OpenStreetMap\",{\"minZoom\":0,\"maxZoom\":18,\"tileSize\":256,\"subdomains\":\"abc\",\"errorTileUrl\":\"\",\"tms\":false,\"noWrap\":false,\"zoomOffset\":0,\"zoomReverse\":false,\"opacity\":1,\"zIndex\":1,\"detectRetina\":false,\"pane\":\"tilePane\"}]},{\"method\":\"addRasterImage\",\"args\":[\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFsAAADBCAYAAACgy8y8AAAF/klEQVR4nO2dPY4UMRCFq9lNOAIkRAScYFcCEXEBECkRFyCAU3AGJCTSFVxgoxVIcIINCMjgCERoCMArj8ftcXfbVa9c9Ukj7f/ar18/l93TbiLHWcOT6fnuyfR8J90OMyALPkk3oDWp0Je7C5g+wjRkKyU3owh+S7oBlnCxGYE4vbZSMyAiRIk7m5FT6QZsAbXEm0Ol2NpEDojn2BrWin25u5ji3+XOcZViE7Vxt4s9Q86RWwXnFlttNaIxtyGdvaRu3iK6O7sSjc5WKzaRPsFh6mxtwq1BXGwLIgdUx4g2RJxtyc0x7M62KjSRxwgr7GIjLOJL4c5mxKTYUmeXSbGJZAQXOcIoFcnwC1EoQksgPl2XwDObCcnSk1VsyxFCxDBAIgiMMpEyFyOSuNiMDFuNoERHzJDORhSaiEFs1I5L0F1shGoEhSFjBBUXm5HhxEYeI7qVfp7VhwznbGSGExv5jOqSbwgdRszu5s5GEBqVIddGYlcj3dO+2Nmh8ahbTcR3JKC1b5Wz406gdagWFW9l0CruHJyiL44RxFFeC8PV2ciYF5szFhcPkKiZ/fvp2c3Htz99E2zJPOadzckQYseuRka92C2E5orG6sxGzepW5PrXusxV7eycq1EHR6JKZ0u5WiqLe03cVDs7BdnVREBLrGtdjC5wTJXY6UZWrdBSsrViqBhpQc+FNpEYaeFoTfERYBXbWmykwAyQKPSc3GTFDv+w1f55LdEYH4GDI9ZTWO1ZvdXhXo0wwia2dlcvYS4dVDj79qdvEEIfi9hj3z8Q26+eb6MkeFbYXoOkhfUPonnDniKVdSmaRK4pk1VktiZKMcw6gwxOLcWJJjcHasc5uBmiRmrF9hhh5BaRl3tc7InscVLHWnN6jDCyJ3Y4Yh4r82zRJjtd9zg5pIUB/UrNDLV3nC2heLQsO7xHlFb9QauitxbcY+Q/HEVBtdg9Mswaq4/maIJDOVsrpXVm+HvXif41XNvE53J3MYWXVBs2/2P0OEEyxeq1EXSRibCEJlrpbBd6Hauc7QtW6xh2iRXx7Bu2zkY864atRhDFHjJGEIUm2jCpSd8wj9RB1LOtuUAoHUU6+IEhYwSVYRaiEJ2c0tzZGjotxTAxEu+kKd2WObq5ULLTqGfXMM7WgIvNCEw1UnO/jcY3ysd0zbaa3F5zU9Mx0T2zGUGtSMQevlly9M/H+826e5XXTpvDRWIkJ3QqcI6c6CXB0cTuGiPSnUXbip89s1NX/3w8Vbk6/tkvH9/c/ELNAIsieNfS71gnU5EfnV8X/97nrw+yX//99ExFWdjN2TmhJfeIQnC3qtLv0fk1/Xj1eiKivSipRTrDYcROI+T9vau9V+DF15c3YqXZHZ856ecIQIh9LKvXgpbjrEusuUqEKO/qOU7ufD9o88Nnb4vRkIouVZJ2cXYsdE3H5qqMnLA5SvmN5G7Wp+Yt7fifX/e7DGZSgyREZpc4ufN9il9zPxfcHbu8dHAlLqOxPnf9cncxxQLEax1xlNSI27ptHLBePMh17u7V7mag/HD+jn3g4hwsYa7UtODLxzdTqEwQl1+7xEipIyFK0jgJM8MWIFUgMd0yu3RnVvh6EGXN1Fsj8NXIUpAPHGzDtlBTZQyT2U6eIcWWvhw3x5Bil5A8EObElgTydGtBOkgiRIs7mxEXmxEXmxEzYiO8lUF80OgJwlZFMWacjcDQzibCcrdJZ/sFXwMMHyNEZSdzRop5sQMconuMMOJiM+Ji/4ejQjEhNsLyKpGRATJGsjIx4exaekeJObF9IYoRyaVWc5kdkFigMudsSVxsRlxsRjyzM/TKbnc2I6bEri37epWHJsSOxfONAjoSP8BIekFqeLFTJJ/k6tVIAX8e5EY8s40wvNjphgBLnpzX+iwYXuyU9CkkJVpntjmxJRle7NSdtW7tUZMPLzbR8iez+kLUBqRnjgETYhPVVxY9DwzEEZeC+15JM85GwITYKG8ZNkMquMQmuCaP5tIdNVthIkZQcLEZMS0296BoWmyHAb/p1BkDhO0viNzZTktQXO0w8xeF5KThuEkQ3AAAAABJRU5ErkJggg==\",[[28.6198577925929,92.12086803477985],[9.612046147567685,101.6606141096507]],0.4980392156862745,null,\"tmap401\",\"kde_Q121_raster\"]},{\"method\":\"addLegend\",\"args\":[{\"colors\":[\"#440154\",\"#3B528B\",\"#21908C\",\"#5DC863\",\"#FDE725\"],\"labels\":[\"0.00 to 0.01\",\"0.01 to 0.02\",\"0.02 to 0.03\",\"0.03 to 0.04\",\"0.04 to 0.05\"],\"na_color\":null,\"na_label\":\"NA\",\"opacity\":0.4980392156862745,\"position\":\"topright\",\"type\":\"unknown\",\"title\":\"v\",\"extra\":null,\"layerId\":\"legend401\",\"className\":\"info legend kde_Q121_raster\",\"group\":\"kde_Q121_raster\"}]},{\"method\":\"addLayersControl\",\"args\":[[],\"kde_Q121_raster\",{\"collapsed\":true,\"autoZIndex\":true,\"position\":\"topleft\"}]}],\"limits\":{\"lat\":[9.612046147567685,28.6198577925929],\"lng\":[92.12086803477985,101.6606141096507]},\"fitBounds\":[9.648057490065488,92.12086803477986,28.61985779259291,101.6320025320585,[]]},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n",
    "supporting": [
      "Take-home_Ex01_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/htmltools-fill-0.5.8.1/fill.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<script src=\"../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\n<link href=\"../../site_libs/leaflet-1.3.1/leaflet.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/leaflet-1.3.1/leaflet.js\"></script>\n<link href=\"../../site_libs/leafletfix-1.0.0/leafletfix.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/proj4-2.6.2/proj4.min.js\"></script>\n<script src=\"../../site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js\"></script>\n<link href=\"../../site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/leaflet-binding-2.2.2/leaflet.js\"></script>\n<script src=\"../../site_libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js\"></script>\n<script src=\"../../site_libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}